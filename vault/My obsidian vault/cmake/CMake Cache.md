1. [[#Что хранится в CMakeCache]]
2. [[#Как добавить переменную в CMakeCache]]
3. [[#Изменение перменных CMakeCache]]
4. [[#Изменение значений внутри CMakeCache]]

`CMakeCache.txt` - можно считать файлом конфигурации сборки CMake. Этот файл используется для того, чтобы сохранять значения глобальных переменных кэша сборки, которые будут сохраняться на протяжении последующих вызовов сборки. 

---
### Что хранится в CMakeCache

В `CMakeCache.txt` хранятся:
- **переменные сборки** (установленные в `CMakeLists.txt` через ==`set()`== или переданные в качестве параметров вызова `cmake` н. п. ==`-DUSE_MY_VAR=on`==)
- **глобальные переменные CMake** (н. п. ==`CMAKE_INSTALL_PATH`==)
- **опции сборки** (установленные в `CMakeLists.txt` через ==`option()`==)

---
### Как добавить переменную в CMakeCache

>[!example]- Пример установки переменной в кэш 
>```cmake
>set(USE_JPEG ON CACHE BOOL "include jpeg support?")
>```
>>[!attention] Если переменная `USE_JPEG` уже есть в кэше, то данный `set()` ничего не сделает. Он выполнится только если такой переменной в кэше нет.

>[!example]- Пример создания опции
>```cmake
>option(USE_JPEG "Do you want to use the jpeg library")
>```

> [!faq]-  Как посмотреть значения опций сборок из кэша?
> Посмотреть значения всех опций и переменных кэша сборки можно через `cmake-gui` или `ccmake`
> ```bash
> cmake-gui BUILD_DIR
> ccmake BUILD_DIR
>```

---
### Изменение перменных CMakeCache

Изменение переменных кэша в контексте `CMakeLists.txt` через `set()` приведёт к изменению значения данной переменной в этом контексте, без изменений значения в самом кэше.

> [!attention]
> Значения перменных из кэша используются, только если эти переменные не были переопределены в данном контексте скрипта сборки `CMake`

---
### Изменение значений внутри CMakeCache

Изменить значение переменных, которые уже находятся в кэше можно двумя способами:

1. передачей значений переменных в команду сборки `cmake` в качестве параметров через `-D`

```bash
cmake -DUSE_JPEG=OFF -B BUILD_DIR
```

2. `set()` с параметрами `CACHE` и `FORCE`

```cmake
set(USE_JPEG OFF CACHE BOOL "include jpeg support?" FORCE)
```

3. `set_property()` с параметром `CACHE`

```cmake
set_property(CACHE USE_JPEG PROPERTY VALUE OFF)
```

---
[[CMake|Назад]]

#cmake/masteringcmake
